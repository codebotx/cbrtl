<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>QTree | Chillpost.in</title><meta name=keywords content="project"><meta name=description content="Inspired by KoalasToTheMax, QTree is a short live demonstration of image compression and decompression using Quadtrees that partition a two-dimensional image by recursively subdividing it into four quadrants."><meta name=author content="Anubhab Patnaik"><link rel=canonical href=https://anubhavp.dev/blog/posts/qtree/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.min.4b3654b1e7f52ee40f91deb1259c5bf97d2d0b5568e3d5a85ecb142c731894b7.css integrity="sha256-SzZUsef1LuQPkd6xJZxb+X0tC1Vo49WoXssULHMYlLc=" rel="preload stylesheet" as=style><link rel=icon href=https://anubhavp.dev/blog/favicon.ico><link rel=apple-touch-icon href=https://anubhavp.dev/blog/apple-touch-icon.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-F5NTM76P29"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F5NTM76P29",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary"><meta name=twitter:title content="QTree | Chillpost.in"><meta name=twitter:description content="Inspired by KoalasToTheMax, QTree is a short live demonstration of image compression and decompression using Quadtrees that partition a two-dimensional image by recursively subdividing it into four quadrants."><meta property="og:title" content="QTree | Chillpost.in"><meta property="og:description" content="Inspired by KoalasToTheMax, QTree is a short live demonstration of image compression and decompression using Quadtrees that partition a two-dimensional image by recursively subdividing it into four quadrants."><meta property="og:type" content="article"><meta property="og:url" content="https://anubhavp.dev/blog/posts/qtree/"><meta property="og:image" content="https://anubhavp.dev/blog/papermod-cover.png"><meta property="og:image" content="https://anubhavp.dev/favicon.ico"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-14T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-14T00:00:00+00:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://anubhavp.dev/blog/posts/"},{"@type":"ListItem","position":2,"name":"QTree","item":"https://anubhavp.dev/blog/posts/qtree/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"QTree | Chillpost.in","name":"QTree","description":"Inspired by KoalasToTheMax, QTree is a short live demonstration of image compression and decompression using Quadtrees that partition a two-dimensional image by recursively subdividing it into four quadrants.","keywords":["project"],"wordCount":"1253","inLanguage":"en","datePublished":"2023-02-14T00:00:00Z","dateModified":"2023-02-14T00:00:00Z","author":{"@type":"Person","name":"Anubhab Patnaik"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://anubhavp.dev/blog/posts/qtree/"},"publisher":{"@type":"Organization","name":"Chillpost.in","logo":{"@type":"ImageObject","url":"https://anubhavp.dev/blog/favicon.ico"}}}</script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class="type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://anubhavp.dev/blog/ accesskey=h title="Chillpost.in (Alt + H)">Chillpost.in</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://anubhavp.dev/blog/archives/ title=Archive>Archive</a></li><li><a href=https://anubhavp.dev/blog/search/ title="Search (Alt + /)" data-no-instant accesskey=/>Search</a></li><li><a href=https://anubhavp.dev/blog/tags/ title=Tags>Tags</a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://anubhavp.dev/blog/>Home</a>&nbsp;»&nbsp;<a href=https://anubhavp.dev/blog/posts/>Posts</a></div><h1 class=post-title>QTree</h1><div class=post-description>Inspired by KoalasToTheMax, QTree is a short live demonstration of image compression and decompression using Quadtrees that partition a two-dimensional image by recursively subdividing it into four quadrants.</div><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>February 14, 2023</span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=https://anubhavp.dev/blog/tags/project/>project</a></span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>6 min</span></span></div></header><div class="toc side left"><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#quadtree aria-label=Quadtree>Quadtree</a><ul><li><a href=#member-functions aria-label="Member Functions">Member Functions</a></li><li><a href=#node aria-label=Node>Node</a></li></ul></li><li><a href=#demonstration aria-label=Demonstration>Demonstration</a></li><li><a href=#working aria-label=Working>Working</a><ul><li><a href=#image-data-compression aria-label="Image Data Compression">Image Data Compression</a><ul><li><a href=#bounding-box aria-label="Bounding Box">Bounding Box</a></li></ul></li><li><a href=#image-data-to-quadtree aria-label="Image data to Quadtree">Image data to Quadtree</a></li></ul></li></ul></div></details></div><div class=post-content><p>I was going through a blog post on some of the most exciting web pages built for fun and came across <a href=https://koalastothemax.com/>KoalasToTheMax</a>, and I was fascinated by it. <a href=https://injuly.in/>Srijan</a> explained to me how it works, and then we were inspired to build something similar.</p><p>Before we get into the demonstration and the details of how it works, let&rsquo;s have a brief look at the basic data structures used in this project.</p><h2 id=quadtree>Quadtree<a hidden class=anchor aria-hidden=true href=#quadtree>¶</a></h2><p>A quadtree is a tree-based data structure where each node has exactly four child nodes. Our quadtree represents a partition of space in two dimensions by decomposing the region into four equal quadrants. Each quadrant is then subdivided into four equal quadrants, and so on. Each node in the tree either has exactly four children or has no children (a leaf node). The height of quadtrees is sensitive to and dependent on the amount of interesting data in the space being decomposed.</p><p><img loading=lazy src=https://upload.wikimedia.org/wikipedia/commons/a/a0/Quad_tree_bitmap.svg alt=quadtree></p><p>The root node is the image. Each node is the average value of all its children&rsquo;s pixel values. The tree is recursively subdivided until each leaf node is a single pixel. The tree is then traversed to compress the image. The tree is traversed again to decompress the image.</p><h3 id=member-functions>Member Functions<a hidden class=anchor aria-hidden=true href=#member-functions>¶</a></h3><p>Our quadtree has the following member functions:</p><ul><li><strong>compressImageData</strong> : compresses the image data. Takes the image data and the compression factor as the input and returns the quadtree.</li><li><strong>createQTreeOfHeight</strong> : curates the quadtree. Takes the height of the tree and the bounding box as the input and returns the quadtree.</li><li><strong>populate</strong> : populates the quadtree with the pixel values. Takes the quadtree and the image data as the input and returns the quadtree.</li><li><strong>getRGBValuesFromCoordinates</strong> : returns the pixel value at the given coordinates. Takes the quadtree and the coordinates as the input and returns the pixel value.</li></ul><h3 id=node>Node<a hidden class=anchor aria-hidden=true href=#node>¶</a></h3><p>The QTNODE class represents a node in the quadtree. It has the following properties:</p><ul><li><strong>x</strong> : x-coordinate of the top-left corner of the bounding box.</li><li><strong>y</strong> : y-coordinate of the top-left corner of the bounding box.</li><li><strong>w</strong> : width of the bounding box.</li><li><strong>h</strong> : height of the bounding box.</li><li><strong>children</strong> : array of four children.</li><li><strong>rgb</strong> : pixel value of the node.</li></ul><p>Functions:</p><ul><li><strong>draw</strong> : draws the node. Takes the canvas context as the input and returns nothing.</li><li><strong>insert</strong>: inserts a node into the quadtree. Takes the quadtree and the node as the input and returns the quadtree.</li><li><strong>drawAtHeight</strong>: draws the nodes at a given height. Takes the canvas context, the height of the tree, and the current height as the input and returns nothing.</li><li><strong>draw</strong>: draws the nodes. Takes the canvas context and the height of the tree as the input and returns nothing.</li><li><strong>reveal</strong>: reveals the nodes. Takes the canvas context and the height of the tree as the input and returns nothing.</li><li><strong>computeAverageColor</strong>: computes the average color of the node. Takes the quadtree and the image data as the input and returns the pixel value.</li></ul><h2 id=demonstration>Demonstration<a hidden class=anchor aria-hidden=true href=#demonstration>¶</a></h2><div class=container style=text-align:center><canvas id=canvas-2 style="border:1px solid #000"></canvas><br>Hover over any part of the canvas to recursively divide it into four quadrants.</div><div class=container style=text-align:center><canvas id=canvas-1 style="border:1px solid #000"></canvas><br><input type=range id=slider min=0 max=100 value=0><br>The slider controls the depth of the tree.</div>The slider is set to 0 by default, which means the entire image is compressed into a single pixel. The slider when set to 100 means the image is not compressed at all. The slider can be set to any value between 0 and 100.
<script type=module src=/blog/js/qtree/index.js></script>
<script type=module src=/blog/js/qtree/qdtree.js></script><h2 id=working>Working<a hidden class=anchor aria-hidden=true href=#working>¶</a></h2><p>The image is loaded into a canvas. We have two canvases, one for you to hover over and the other for you to control the depth of the tree using a slider and render the nodes evenly. Initially, we had multiple ways to taking an image as the input form the user, such as uploading an image, using query parameters, etc., but for the purpose of this demonstration, we decided to keep it simple and use a static image.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=font-weight:700>const</span> image = <span style=font-weight:700>new</span> Image();
</span></span><span style=display:flex><span>img.src = <span style=font-style:italic>&#34;/blog/assets/images/qtree/cryptopunk.jpeg&#34;</span>;
</span></span><span style=display:flex><span>img.onload = () =&gt; {
</span></span><span style=display:flex><span>    initSliderCanvas(img);
</span></span><span style=display:flex><span>    initMouseCanvas(img);
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>I&rsquo;ll go ahead and explain the working of the mouse hover canvas and you can explore the slider canvas. Source codes are available on <a href=https://github.com/cbrtl/qd-compression>Github</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=font-weight:700>import</span> { compressImageData } from <span style=font-style:italic>&#34;./qdtree.js&#34;</span>;
</span></span><span style=display:flex><span><span style=font-weight:700>function</span> initMouseCanvas(img){
</span></span><span style=display:flex><span>	<span style=font-weight:700>const</span> canvas = document.getElementById(<span style=font-style:italic>&#34;canvas-2&#34;</span>);
</span></span><span style=display:flex><span>    <span style=font-weight:700>const</span> ctx = canvas.getContext(<span style=font-style:italic>&#34;2d&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>const</span> imageData = readImageDataUsingCanvas(canvas, ctx, image);
</span></span><span style=display:flex><span>    <span style=font-weight:700>const</span> qTree = compressImageData(imageData, 1);
</span></span><span style=display:flex><span>    qTree.draw(ctx);
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=image-data-compression>Image Data Compression<a hidden class=anchor aria-hidden=true href=#image-data-compression>¶</a></h3><p>We import the <code>compressImageData</code> function from the <code>qdtree.js</code> file. This function takes the image data and the compression factor as the input and returns the quadtree. The <strong>height of the tree</strong> is calculated by taking the log of the number of pixels in the image and dividing it by the log of 4. The log of 4 is 2, and the log of the number of pixels is the height of the tree. The height of the tree is then rounded down to the nearest integer. The tree is then created using the <code>createQTreeOfHeight</code> function that takes the height of the tree and the <strong>bounding box</strong> as the input and returns the quadtree.</p><p><strong>qdtree.js</strong></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=font-weight:700>export</span> <span style=font-weight:700>function</span> compressImageData(imageData, factor) {
</span></span><span style=display:flex><span>  <span style=font-weight:700>const</span> { width, height } = imageData;
</span></span><span style=display:flex><span>  <span style=font-weight:700>const</span> newWidth = Math.ceil(width / factor);
</span></span><span style=display:flex><span>  <span style=font-weight:700>const</span> newHeight = Math.ceil(height / factor);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=font-weight:700>const</span> qTreeHeight = Math.floor(Math.log(newWidth * newHeight) / Math.log(4));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=font-weight:700>const</span> qTree = createQTreeOfHeight(qTreeHeight, {
</span></span><span style=display:flex><span>    x: 0,
</span></span><span style=display:flex><span>    y: 0,
</span></span><span style=display:flex><span>    w: width,
</span></span><span style=display:flex><span>    h: height,
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  populate(qTree, imageData);
</span></span><span style=display:flex><span>  <span style=font-weight:700>return</span> qTree;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The <code>createQTreeOfHeight</code> function takes in the height of the tree and the bounding box as the input and returns the quadtree.</p><h4 id=bounding-box>Bounding Box<a hidden class=anchor aria-hidden=true href=#bounding-box>¶</a></h4><p>The bounding box is the area that the node represents. The bounding box is initially the entire image. The bounding box is then divided into four equal quadrants, and the process is repeated until the height of the tree is 0. The <code>populate</code> function takes the quadtree and the image data as the input and populates the tree with the average pixel values of the children&rsquo;s pixel values.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span> <span style=font-weight:700>function</span> createQTreeOfHeight(height, aabb) {
</span></span><span style=display:flex><span>  <span style=font-weight:700>function</span> recursiveCreate(node, height) {
</span></span><span style=display:flex><span>    <span style=font-weight:700>if</span> (height === 0) <span style=font-weight:700>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>const</span> { x, y, w, h } = node.aabb;
</span></span><span style=display:flex><span>    <span style=font-weight:700>const</span> halfW = w / 2;
</span></span><span style=display:flex><span>    <span style=font-weight:700>const</span> halfH = h / 2;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=font-style:italic>//top left
</span></span></span><span style=display:flex><span><span style=font-style:italic></span>    node.tl = <span style=font-weight:700>new</span> QTNode({
</span></span><span style=display:flex><span>      x,
</span></span><span style=display:flex><span>      y,
</span></span><span style=display:flex><span>      w: halfW,
</span></span><span style=display:flex><span>      h: halfH,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>		<span style=font-style:italic>//top right
</span></span></span><span style=display:flex><span><span style=font-style:italic></span>    node.tr = <span style=font-weight:700>new</span> QTNode({
</span></span><span style=display:flex><span>      x: x + halfW,
</span></span><span style=display:flex><span>      y,
</span></span><span style=display:flex><span>      w: halfW,
</span></span><span style=display:flex><span>      h: halfH,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>		<span style=font-style:italic>//bottom left
</span></span></span><span style=display:flex><span><span style=font-style:italic></span>    node.bl = <span style=font-weight:700>new</span> QTNode({
</span></span><span style=display:flex><span>      x,
</span></span><span style=display:flex><span>      y: y + halfH,
</span></span><span style=display:flex><span>      w: halfW,
</span></span><span style=display:flex><span>      h: halfH,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>		<span style=font-style:italic>//bottom right
</span></span></span><span style=display:flex><span><span style=font-style:italic></span>    node.br = <span style=font-weight:700>new</span> QTNode({
</span></span><span style=display:flex><span>      x: x + halfW,
</span></span><span style=display:flex><span>      y: y + halfH,
</span></span><span style=display:flex><span>      w: halfW,
</span></span><span style=display:flex><span>      h: halfH,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    recursiveCreate(node.tl, height - 1);
</span></span><span style=display:flex><span>    recursiveCreate(node.tr, height - 1);
</span></span><span style=display:flex><span>    recursiveCreate(node.bl, height - 1);
</span></span><span style=display:flex><span>    recursiveCreate(node.br, height - 1);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span> }
</span></span></code></pre></div><h3 id=image-data-to-quadtree>Image data to Quadtree<a hidden class=anchor aria-hidden=true href=#image-data-to-quadtree>¶</a></h3><p>The <code>reveal</code> function takes the x and y coordinates of the mouse as the input and reveals the nodes that are under the mouse. The <code>draw</code> function draws the nodes on the canvas. The <code>update</code> function is called every 30 milliseconds to update the canvas. The <code>update</code> function clears the canvas and draws the nodes on the canvas. The <code>update</code> function is called every 30 milliseconds to update the canvas. The <code>update</code> function clears the canvas and draws the nodes on the canvas.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=font-weight:700>function</span> initMouseCanvas(img){
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span> <span style=font-weight:700>const</span> mousePos = { x: 0, y: 0 };
</span></span><span style=display:flex><span>    <span style=font-weight:700>let</span> lastUpdateTime = -<span style=font-weight:700>Infinity</span>;
</span></span><span style=display:flex><span>    <span style=font-weight:700>const</span> frameTime = 30;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>function</span> update() {
</span></span><span style=display:flex><span>        <span style=font-weight:700>const</span> currentTime = Date.now();
</span></span><span style=display:flex><span>        <span style=font-weight:700>const</span> diff = currentTime - lastUpdateTime;
</span></span><span style=display:flex><span>        <span style=font-weight:700>if</span> (diff &lt; frameTime) <span style=font-weight:700>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        lastUpdateTime = currentTime;
</span></span><span style=display:flex><span>        ctx.clearRect(0, 0, canvas.width, canvas.height);
</span></span><span style=display:flex><span>        qTree.reveal(mousePos.x, mousePos.y);
</span></span><span style=display:flex><span>        qTree.draw(ctx);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    canvas.addEventListener(<span style=font-style:italic>&#34;mousemove&#34;</span>, (e) =&gt; {
</span></span><span style=display:flex><span>        <span style=font-weight:700>const</span> rect = canvas.getBoundingClientRect();
</span></span><span style=display:flex><span>        <span style=font-weight:700>const</span> x = e.clientX - rect.left;
</span></span><span style=display:flex><span>        <span style=font-weight:700>const</span> y = e.clientY - rect.top;
</span></span><span style=display:flex><span>        mousePos.x = x;
</span></span><span style=display:flex><span>        mousePos.y = y;
</span></span><span style=display:flex><span>        update();
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><em>Ref: <a href=https://en.wikipedia.org/wiki/Quadtree>Wikipedia</a></em></p></div><footer class=post-footer><nav class=paginav><a class=next href=https://anubhavp.dev/blog/posts/rust/><span class=title>Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>Rust: The next C++ ?</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://anubhavp.dev/blog/>Chillpost.in</a></span><span style=display:inline-block;margin-left:1em>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/blog/js/medium-zoom.min.js data-no-instant></script>
<script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a="1"=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>